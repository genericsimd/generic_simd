<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Generic SIMD Library: Generic SIMD Library</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Generic SIMD Library
   &#160;<span id="projectnumber">0.2</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Generic SIMD Library </div>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="overview"></a>
Overview</h2>
<p>Generic SIMD Library provides C++ based simple interfaces to use SIMD intrinsics.</p>
<p>The current implementation have short vector with lanes=4 support. Here lanes=4 means all the short vector data types in this library contain 4 scalar elements. A generic short vector library with lanes could be 2,4,8,16,32... is in developing.</p>
<p>Here is the hello vector example using power vsx SIMD.</p>
<div class="fragment"><pre class="fragment"> {.cpp}
<span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;gsimd.h&gt;</span>

<span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])
{
    svec4_f v1(1.1, 2.2, 3.3, 4.4);
    svec4_f v2 = v1 * 2;
    std::cout &lt;&lt; <span class="stringliteral">&quot;Hello, &quot;</span> &lt;&lt; v2 &lt;&lt; std::endl;
    <span class="keywordflow">return</span> 0;
}
</pre></div><p>Compile and run it on Power7 Platform.</p>
<div class="fragment"><pre class="fragment"> {.sh}
$ g++ -I../../include HelloSIMD.cpp -mvsx -flax-vector-conversions -o HelloSIMD -Wno-<span class="keywordtype">int</span>-to-pointer-cast
$ ./HelloSIMD
Hello, svec4_f[2.2, 4.4, 6.6, 8.8]
</pre></div><p>Compile and run it on Intel Platform.</p>
<div class="fragment"><pre class="fragment"> {.sh}
$ g++ -I../../include HelloSIMD.cpp -msse4.2 -o HelloSIMD -Wno-<span class="keywordtype">int</span>-to-pointer-cast
$ ./HelloSIMD
Hello, svec4_f[2.2, 4.4, 6.6, 8.8]
</pre></div><p>The current implementation needs gcc to compile. </p>
<ul>
<li>
../../include contains the header files </li>
<li>
-mvsx enable gcc support Power vsx SIMD </li>
<li>
-msse4.2 enable gcc support Intel SSE4.2 SIMD </li>
<li>
-Wno-int-to-pointer-cast -flax-vector-conversions not show warnings and enable vector casts </li>
</ul>
<h2><a class="anchor" id="datatypes"></a>
Data Types</h2>
<p>The current library has short vector types </p>
<ul>
<li>
bool (svec4_i1)  </li>
<li>
char (svec4_i8, svec4_u8)  </li>
<li>
short (svec4_i16, svec4_u16) </li>
<li>
integer (svec4_i32, svec4_u32) </li>
<li>
long long (svec4_i64, svec4_u64) </li>
<li>
float (svec4_f) and double (svec4_d) </li>
</ul>
<p>The "i" here means signed types, and "u" means unsigned types.</p>
<p>In the following document we use VTYPE to express the short vector types, and STYPE to express scalar types.</p>
<h2><a class="anchor" id="operation"></a>
Operations</h2>
<h3><a class="anchor" id="construction"></a>
Short vector construction</h3>
<ul>
<li>
Default constructor returns a vector with undefined value. e.g. "svec4_i32 v;" You can modify it's elements by "[]" operator.  </li>
<li>
Construct a short vector with four scalar values. e.g. "svec4_i32 v(1,2,3,4)"  </li>
<li>
Construct a short vector with one scalar value. e.g. "svec4_i32 v(100)". All the four values in the short vector is 100.  </li>
</ul>
<h3><a class="anchor" id="access"></a>
Access single element in the short vector</h3>
<p>"[]" operator is used to get and set the elements. </p>
<div class="fragment"><pre class="fragment"> {.cpp}
svec4_i32 v(1,2,3,4);
<span class="keywordtype">int</span> a = v[2]; <span class="comment">//a is 3 now.</span>
v[3] = 10; <span class="comment">//v is [1,2,3,10] now.</span>
</pre></div><p>Due to the current limitation, bool vector's setter must use "-1" as true in the right hand side. </p>
<div class="fragment"><pre class="fragment"> {.cpp}
svec4_i1 m(0); <span class="comment">//all elements are false</span>
m[0] = -1; <span class="comment">//m&#39;s first element is true.</span>
</pre></div><h3><a class="anchor" id="commonop"></a>
Common operations</h3>
<p>Here is a short list for common operations. Please refer the detail documents for all operations.</p>
<h4>Load and Store </h4>
<p>Store a vector to location p through instance method store(VTYPE *).</p>
<p>Load a vector from location p through class static method VTYPE::(VTYPE *). e.g. "svec4_i32::load(an_address)" will return a new svec4_i32 vector.</p>
<p>Load a scalar value from an address and splat it into the whole vector could be done through class static method VTYPE::load_and_splat(STYPE *)</p>
<p>There is another method called VTYPE::load_const(STYPE*), which has similar semantics.</p>
<h3><a class="anchor" id="compare"></a>
Compare Operations</h3>
<p>Compare two vectors, and return a svec4_i1 vector.</p>
<p>Operators: == != for all types</p>
<p>Operators: &gt;, &gt;=, &lt;, &lt;= for all types except svec4_i1.</p>
<h4>Bit operations </h4>
<p>svec4_i1 has operator ~ to reverse the boolean value.</p>
<p>Binary bit operators &amp;, |, ^ are available for all integer vector types.</p>
<p>Logical operators !, &amp;&amp;, || are available for svec4_i1 type.</p>
<h3><a class="anchor" id="math"></a>
Math operations</h3>
<p>Support all types except svec4_i1.</p>
<p>Unary operator "-" is used to get the neg value for non-boolean vectors</p>
<p>Binary operators +, -, *, / can support VTYPE op VTYPE, VTYPE op STYPE, STYPE op VTYPE.</p>
<p>Binary operators &gt;&gt;, &lt;&lt;, % can support VTYPE op VTYPE, VTYPE op STYPE over all integer types. &gt;&gt; and &lt;&lt; for shift, and % for remainder. Please note shift by a vector can only has unsigned integer vector in the right hand.</p>
<h3><a class="anchor" id="methodop"></a>
Instance methods operations</h3>
<p>broadcast(), rotate(), shuffle() support all types exclude svec4_i1().</p>
<p>round(), floor(), ceil(), sqrt(), rcp(), rsqrt(), exp(), log(), pow(VTYPE) support svec4_f, and svec4_d.</p>
<p>All above will return a new vector.</p>
<p>reduce_add(), reduce_max(), reduce_min() do a vector scope's reduction, and return a scalar value.</p>
<p>any_true(), all_true(), none_true() do a svec4_i1 vector's reduction, and return a boolean scalar value.</p>
<h3><a class="anchor" id="gather-scatter"></a>
Gather and Scatter</h3>
<p>Please refer the detail document for how to use gather and scatter. E.g. svec4_i32 type </p>
<ul>
<li>
vsx::svec4_i32::gather() </li>
<li>
vsx::svec4_i32::scatter() </li>
<li>
vsx::svec4_i32::gather_base_offsets() </li>
<li>
vsx::svec4_i32::scatter_base_offsets() </li>
<li>
vsx::svec4_i32::gather_stride() </li>
<li>
vsx::svec4_i32::scatter_stride() </li>
</ul>
<p><b>Note</b> The current power processor has no gather/scatter instructions. The software based implementation is slow right now, especially the gather_base_offsets() and scatter_base_offsets().</p>
<p>In case of regular stride style gather/scatter, it's better to use gather_stride() and scatter_stride().</p>
<h3><a class="anchor" id="otherop"></a>
Other Operations</h3>
<h4><a class="anchor" id="fmaop"></a>
Multiply-Add and Multiply-Sub</h4>
<p>VTYPE svec_madd(VTYPE a, VTYPE b, VTYPE c) returns a * b + c;</p>
<p>VTYPE svec_msub(VTYPE a, VTYPE b, VTYPE c) returns a * b - c;</p>
<p>VTYPE svec_nmsub(VTYPE a, VTYPE b, VTYPE c) returns -(a * b - c);</p>
<h4><a class="anchor" id="selectop"></a>
Select operation</h4>
<p>The prototype is svec_select(svec4_i1 mask, VTYPE a, VTYPE b), and return a new vector whose elements are selected from a or b based on the mask. True from a and false from b.</p>
<p>There is another select svec_select(bool cond, VTYPE a, VTYPE b), which is the same as "cond ? a : b".</p>
<h4><a class="anchor" id="castop"></a>
Type cast operation</h4>
<p>The prototype is svec_cast&lt;TO_VTYPE&gt;(FROM_VTYPE). It supports all combinations of type cast. Each element's cast semantics is the same as scalar cast.</p>
<h3><a class="anchor" id="maskedop"></a>
Operation with mask</h3>
<p>load, store, gatter, scatter, compare operations have a masked version. Please refer the detail document for detail.</p>
<h2><a class="anchor" id="perf"></a>
Performance Evaluation</h2>
<p>We have ported some examples from intrinsics implementation to Generic SIMD implementation, and evaluated their performance.</p>
<p>Applications include </p>
<ul>
<li>
RGB2Gray, float </li>
<li>
Mandelbrot, float </li>
<li>
SPSS-sweep, double </li>
<li>
Dgemm, double </li>
<li>
CVA-Mean, float </li>
</ul>
<p>Some of them only have Power Platform intrinsics implementation, and some of them only have intel intrinsics implementation. We compared the generic SIMD's performance with the intrinsics implementation by measure their speed up over scalar code.</p>
<p>We also evaluated the portability of our GSIMD library by running the generic SIMD version application on the platform without intrinsics implementation.</p>
<p>Below are the result.</p>
<p>The following figures show the performance speedup versus the scalar code on different platforms.</p>
<p>Higher is better.</p>
<div class="image">
<img src="power_apps.jpg" alt="power_apps.jpg"/>
<div class="caption">
App on Power Platform</div></div>
<div class="image">
<img src="intel_apps.jpg" alt="intel_apps.jpg"/>
<div class="caption">
App on Intel Platform</div></div>
<div class="image">
<img src="power2intel_apps.jpg" alt="power2intel_apps.jpg"/>
<div class="caption">
App with Power Intrinsics only</div></div>
<div class="image">
<img src="intel2power_apps.jpg" alt="intel2power_apps.jpg"/>
<div class="caption">
App with Intel Intrinsics only</div></div>
<h2><a class="anchor" id="references"></a>
Other References</h2>
<ul>
<li>
<a class="el" href="developer_guide.html">Developer Guide</a> </li>
<li>
<a class="el" href="issues.html">Limitations and Issues</a> </li>
<li>
<a class="el" href="history.html">History</a> </li>
</ul>
</div></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Mon Sep 16 2013 15:23:55 for Generic SIMD Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5
</small></address>

</body>
</html>
